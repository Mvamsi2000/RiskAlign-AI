<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>RiskAlign-AI Summary</title>
    <style>
      body { font-family: Arial, sans-serif; margin: 2rem; color: #0f172a; }
      header { border-bottom: 2px solid #1d4ed8; padding-bottom: 1rem; margin-bottom: 2rem; }
      h1 { margin: 0; font-size: 2rem; }
      section { margin-bottom: 2rem; }
      table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
      th, td { border: 1px solid #cbd5f5; padding: 0.5rem 0.75rem; text-align: left; }
      th { background-color: #e0e7ff; }
      ul { margin: 0; padding-left: 1.25rem; }
      .metric { font-size: 1.1rem; margin: 0.25rem 0; }
    </style>
  </head>
  <body>
    <header>
      <h1>RiskAlign-AI Summary</h1>
      <p>Scope: <strong>{{ scope }}</strong> &mdash; Generated: {{ generated_at }}</p>
    </header>

    <section>
      <h2>Scoring Overview</h2>
      <p class="metric">Findings scored: {{ scoring['totals']['count'] }}</p>
      <p class="metric">Average score: {{ '%.2f' | format(scoring['totals']['average_score']) }}</p>
      <p class="metric">Total effort hours: {{ '%.2f' | format(scoring['totals']['total_effort_hours']) }}</p>
      <ul>
        {% for priority, count in scoring['totals']['by_priority'].items() %}
        <li>{{ priority }}: {{ count }}</li>
        {% endfor %}
      </ul>
    </section>

    <section>
      <h2>Remediation Plan</h2>
      <p class="metric">Total waves: {{ plan['totals']['waves'] }} &mdash; Total hours: {{ '%.2f' | format(plan['totals']['total_hours']) }} &mdash; Risk saved: {{ '%.2f' | format(plan['totals']['total_risk_saved']) }}</p>
      {% for wave in plan['waves'] %}
      <h3>{{ wave['name'] }} ({{ wave['total_hours'] }}h, risk saved {{ wave['risk_saved'] }})</h3>
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Title</th>
            <th>Priority</th>
            <th>Effort (h)</th>
            <th>Score</th>
            <th>Risk Saved</th>
          </tr>
        </thead>
        <tbody>
          {% for item in wave['items'] %}
          <tr>
            <td>{{ item['id'] }}</td>
            <td>{{ item['title'] }}</td>
            <td>{{ item['priority'] }}</td>
            <td>{{ '%.2f' | format(item['effort_hours']) }}</td>
            <td>{{ '%.2f' | format(item['score']) }}</td>
            <td>{{ '%.2f' | format(item['risk_saved']) }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% endfor %}
    </section>

    <section>
      <h2>Impact Outlook</h2>
      <p class="metric">Readiness: {{ '%.2f' | format(impact['readiness_percent']) }}%</p>
      <p class="metric">Compliance boost: {{ '%.2f' | format(impact['compliance_boost']) }}%</p>
      <h3>Risk Saved Curve</h3>
      <ul>
        {% for point in impact['risk_saved_curve'] %}
        <li>{{ point['wave'] }}: {{ '%.2f' | format(point['cumulative_risk_saved']) }} risk saved ({{ '%.2f' | format(point['percent_of_total']) }}%)</li>
        {% endfor %}
      </ul>
    </section>

    <section>
      <h2>Control Coverage</h2>
      <p class="metric">Framework: {{ controls['framework'] }} &mdash; Coverage: {{ '%.2f' | format(controls['coverage']) }}%</p>
      <p class="metric">Controls touched: {{ controls['unique_controls'] | length }}</p>
      <ul>
        {% for control in controls['unique_controls'] %}
        <li>{{ control }}</li>
        {% endfor %}
      </ul>
      {% if controls['unmapped'] %}
      <h3>Unmapped CVEs</h3>
      <ul>
        {% for cve in controls['unmapped'] %}
        <li>{{ cve }}</li>
        {% endfor %}
      </ul>
      {% endif %}
    </section>
  </body>
</html>
